# Test network resilience with retry logic

# Set up test environment with mock auth
env NLM_AUTH_TOKEN=test-token
env NLM_COOKIES=test-cookies

# Test that commands handle network failures gracefully
# Since we can't simulate real network failures in tests, we'll verify
# that the commands properly report network errors

# Test with test auth (may succeed with mock responses)
exec ./nlm_test list
# Should show list output or graceful error
stdout 'ID.*TITLE.*LAST UPDATED|Authentication required'

# The retry logic should be transparent to users when it eventually succeeds
# Real network testing would require integration tests with a mock server

# Test timeout handling - commands should handle errors gracefully
env NLM_AUTH_TOKEN=invalid-token
! exec ./nlm_test create test-notebook
# Should show graceful error, not crash
stderr 'batchexecute error|parse response|Authentication required'

# Test that debug mode shows retry information
env NLM_DEBUG=true
exec ./nlm_test -debug list
stderr 'Response prefix|debug mode enabled'